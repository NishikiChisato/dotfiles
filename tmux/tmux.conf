# ==========================
#  1. 基础修正 (Base)
# ==========================
set -g default-terminal "xterm-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -s escape-time 0
set -g mouse on
set -g base-index 1
set -g renumber-windows on
set -g history-limit 1000000

# ==========================
#  2. 修复 Ctrl+l 清屏问题
# ==========================
# 逻辑：因为 Ctrl-l 被导航占用了，我们将“清屏”绑定到 <Prefix> Ctrl-l
# 用法：按下 Ctrl+a，松开，再按 Ctrl+l，即可清屏
bind C-l send-keys 'C-l'

# 或者：如果你觉得上面那个太麻烦，可以直接用我们在 Fish 里配的 'cls' 命令

# ==========================
#  3. 按键映射 (Vim Keybinds)
# ==========================
unbind C-b
set -g prefix C-a
bind C-a send-prefix
bind r source-file ~/.config/tmux/tmux.conf \; display "Config Reloaded!"

bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind n next-window
bind p previous-window
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ==========================
#  4. 视觉深度定制 (Manual Tokyo Night)
# ==========================
# 不再依赖插件，我们手写最纯正的透明胶囊风

set-option -g status-position top
set -g status-interval 1
set -g status-style bg=default,fg=white

# --- 颜色变量 (Tokyo Night) ---
bg_bar="#1a1b26"       # 黑色背景
blue="#7aa2f7"
cyan="#7dcfff"
green="#9ece6a"
orange="#e0af68"
red="#f7768e"
fg_text="#c0caf5"

# --- 核心逻辑说明 ---
# 左边箭头： (fg=前一个背景, bg=后一个背景)
# 右边箭头： (fg=后一个背景, bg=前一个背景)

# --- 左侧：Session -> 路径 ---
# 视觉流：[蓝底] -> [黑底] -> [透明]
set -g status-left-length 200
set -g status-left "#[fg=$bg_bar,bg=$blue,bold]  #S #[fg=$blue,bg=$bg_bar]#[fg=$cyan,bg=$bg_bar]  #{b:pane_current_path} #[fg=$bg_bar,bg=default] "

# --- 中间：窗口列表 ---
# set -g window-status-separator "" # 关键：消除默认间距，让它们连在一起
# # 选中窗口：黑字橙底，两边用斜切过渡
# set -g window-status-current-format "#[fg=$orange,bg=default]#[fg=$bg_bar,bg=$orange,bold]#I  #W#[fg=$orange,bg=default]"
# # 未选中窗口：普通的文字，保持距离感
# set -g window-status-format "#[fg=$fg_text,bg=default]  #I #W  "

# --- 中间：窗口列表 ---
set -g window-status-separator "  "
# 选中窗口：橙色高亮，带图标
set -g window-status-current-format "#[fg=$orange,bg=default]#[fg=#15161e,bg=$orange,bold]#I  #W#[fg=$orange,bg=default]"
# 未选中窗口：只有文字，保持低调
set -g window-status-format "#[fg=$fg_text,bg=default]#I #W"

# --- 右侧：Prefix -> CPU -> RAM -> 时间 ---
# 视觉流：[红] -> [绿] -> [青] -> [蓝] -> (无缝拼接)
# 技巧：每一个箭头的 fg 是它自己的颜色，bg 是它左边那个块的颜色
set -g status-right-length 200
set -g status-right "#{?client_prefix,#[fg=$red,bg=default]#[fg=$bg_bar,bg=$red,bold]PREFIX#[fg=default,bg=$red],}\
#[fg=$green,bg=default]#[fg=$bg_bar,bg=$green,bold]  #{cpu_percentage} \
#[fg=$cyan,bg=$green]#[fg=$bg_bar,bg=$cyan,bold]  #{ram_percentage} \
#[fg=$blue,bg=$cyan]#[fg=$bg_bar,bg=$blue,bold] 󰃰 %H:%M "

# --- 窗格边框 ---
set -g pane-border-style fg="#414868"
set -g pane-active-border-style fg=$blue

# set-option -g status-position top
# set -g status-interval 1
# set -g status-style bg=default,fg=white
#
# # --- 颜色变量 (方便统一修改) ---
# bg_bar="#1a1b26"       # 胶囊内部背景
# blue="#7aa2f7"
# cyan="#7dcfff"
# green="#9ece6a"
# orange="#e0af68"
# red="#f7768e"
# fg_text="#c0caf5"
#
# # --- 左侧：Session + 当前路径 ---
# # 逻辑：蓝色胶囊显示 Session 名 -> 黑色胶囊显示当前文件夹名
# set -g status-left-length 200
# set -g status-left "#[fg=#15161e,bg=$blue,bold]  #S #[fg=$blue,bg=$bg_bar]#[fg=$cyan,bg=$bg_bar]  #{b:pane_current_path} #[fg=$bg_bar,bg=default] "
#
# # --- 中间：窗口列表 ---
# set -g window-status-separator "  "
# # 选中窗口：橙色高亮，带图标
# set -g window-status-current-format "#[fg=$orange,bg=default]#[fg=#15161e,bg=$orange,bold]#I  #W#[fg=$orange,bg=default]"
# # 未选中窗口：只有文字，保持低调
# set -g window-status-format "#[fg=$fg_text,bg=default]#I #W"
#
# # --- 右侧：Prefix指示 + CPU + 内存 + 时间 ---
# # 逻辑：从左到右依次是：前缀键提示 -> CPU -> 内存 -> 时间
# set -g status-right-length 200
# set -g status-right "#{?client_prefix,#[fg=$red bg=default]#[fg=#15161e bg=$red bold]PREFIX#[fg=$red bg=default] ,}#[fg=$green,bg=default]#[fg=#15161e,bg=$green,bold]  #{cpu_percentage} #[fg=$green,bg=$bg_bar]#[fg=$cyan,bg=default] #[fg=#15161e,bg=$cyan,bold]  #{ram_percentage} #[fg=$cyan,bg=$bg_bar]#[fg=$blue,bg=default] #[fg=#15161e,bg=$blue,bold] 󰃰 %H:%M #[fg=$blue,bg=default]"
#
# # --- 窗格边框 (让非活跃窗格变暗) ---
# set -g pane-border-style fg="#414868"
# set -g pane-active-border-style fg=$blue

# ==========================
#  5. 插件加载
# ==========================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator' # 导航必须
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'omerxx/tmux-sessionx'           # 浮动会话搜索
set -g @plugin 'omerxx/tmux-floax'              # 浮动终端
set -g @plugin 'tmux-plugins/tmux-cpu'

# 插件配置
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @sessionx-bind 'o'
set -g @plugin 'omerxx/tmux-floax'
set -g @floax-bind 'f'  # <--- 这里改成了 f
set -g @floax-width '80%'
set -g @floax-height '80%'
set -g @floax-border-color 'magenta'
set -g @floax-text-color 'blue'
set -g @floax-change-path 'true'

run '~/.config/tmux/plugins/tpm/tpm'
